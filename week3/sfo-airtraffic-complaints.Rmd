---
title: "Air Traffic Noise Complaints Data"
subtitle: "Programming Assignment Week 3"
author: "Achim Gerhardt"
date: "30 Dezember 2018"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r libraries, include=FALSE}
library(plotly)
library(sf)
library(dplyr)
```

## Description
Counts of aircraft noise complaints by community and by month. The Aircraft Noise Abatement Office collects this data via the Complaint Hotline, Online Complaint Form, emails, letters and telephone calls to our office. This information is collected and published in a monthly report which is presented at the SFO Airport Community Roundtable meetings. It is used to understand community's aircraft noise concerns, to collaborate with stakeholders in an effort to reduce and manage aircraft noise.

## Data
```{r echo=FALSE}
# read data set
data <- read.csv("data/Aircraft_Noise_Complaint_Data.csv", header = TRUE, stringsAsFactors = FALSE)

head(data)
```

```{r init, include=FALSE}
minYear <- min(data$Year)
maxYear <- max(data$Year)
```
The dataset contains values from `r minYear` to `r maxYear`.

## Cleaning the data
* remove incomplete rows (only one row)
* all community names are converted to lower case
* the name _South San Franciscio_ is converted to _South San Francisco_
* remove communities with less than 5% of the call


## Aggregated data (accumulated total complaints per community)
```{r process_data, echo=FALSE}
cleaned_data <- data %>%
  na.omit() %>%
  mutate(Community = replace(Community, Community =="South San Franciscio", "South San Francisco")) %>%
  mutate(Community = tolower(Community))
```

```{r aggregate_data, echo=FALSE}
aggregated_data <- cleaned_data %>%
  group_by(Community) %>%
  summarize(total_complaints = sum(Total.Complaints)) %>%
  filter(total_complaints > quantile(total_complaints, 0.5)) %>%
  arrange(desc(total_complaints))
```


```{r plot_bar_chart, echo=FALSE}
# read california census shape file
plot_ly(aggregated_data, x = ~Community, y = ~total_complaints, type = 'bar', name = 'SF Air Traffic Complaints') %>%
  layout(title = "Commulated air traffic noise complaints",
         xaxis = list(title = "Community",
         categoryorder = "array",
         categoryarray = ~total_complaints),
         yaxis = list(title = "# Complaints"))
```

## Map of the communities
```{r read_shapefiles, include=FALSE}
# read california census shape file
ca_places <- sf::st_read("./shape/CA_PLACES/CA_Places_TIGER2016.shp")
ca_state <- sf::st_read("./shape/CA_STATE/CA_State_TIGER2016.shp")
```


```{r plot_map, echo=FALSE, message=FALSE}
complaints_communities <- ca_places %>% 
  mutate(name_lowercase = tolower(NAME)) %>%
  inner_join(aggregated_data %>% mutate(name_lowercase = tolower(Community)), by = c("name_lowercase"))


complaints_communities$hover <- with(complaints_communities, paste(NAME, "<br>", "Complaints", total_complaints))




plot_ly(complaints_communities,
        color=~total_complaints,
        hover=~hover)
```


## References
Aircraft Noise Complaint Data: https://data.sfgov.org/Transportation/Aircraft-Noise-Complaint-Data/q3xd-hfi8  
Geographic data: https://data.ca.gov/dataset/ca-geographic-boundaries
